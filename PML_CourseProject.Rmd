Course Project Practical Machine Learning
=========================================

```{r, echo=FALSE}
xmsg <- sprintf("date and time: %s and version used: %s", Sys.time(), R.Version()$version.string)
```

Synopsis
--------
This prediction project was done on `r xmsg` by Lucho Farje. Using data which has been generated by devices such as Nike, FuelBand, FitBit and Jawbone Up about personal activity and self movements which were attached in their body of different persons. The goal using this dataset is to find patterns using machine learning to build a prediction model. The data to be used is coming from accelerometers on the belt, forearm, arm and dumbell of 6 participants which were asked to perform barbell lifts correctly and incorrectly in five different ways.

Setting Global Environment
--------------------------
This prediction analysis needs some packages in order to be processed. The **caret** package is important for this prediction model as well as another support packages which makes the entire analysis process much easier to perform.
An important hint in this process is to highlight that in this step it's being initialized the seed variable and creating a clusters of cores for this computer. 

```{r cache=FALSE,echo=TRUE,results='hide'}
library(caret)
library(randomForest)
library(parallel)
library(doParallel)
library(ggplot2)
library(reshape2)
library(xtable)
#using parallel clusters for the cores of this machine/server
cluster.cores<-makeCluster(detectCores()-1)
registerDoParallel(cluster.cores)
#Initialize seed
day.of.begin.project<-"2015-01-16"
seed.number<-as.numeric(as.Date(day.of.begin.project))
set.seed(seed.number)
```

Download and Load Datasets
--------------------------
In this step the data will be downloaded and loaded into variables in order to be filtered and pre-processed for applying the prediction model.

```{r, cache=TRUE, echo=TRUE}
if (!file.exists("./data/pml-testing.csv"))
  { download.file("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv", "./data/pml-testing.csv") }

if (!file.exists("./data/pml-training.csv"))
  { download.file("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv", "./data/pml-training.csv") }

data.training<-read.csv("./data/pml-training.csv", na.strings=c("NA",""), stringsAsFactors=FALSE)
data.testing<-read.csv("./data/pml-testing.csv", na.strings=c("NA",""), stringsAsFactors=FALSE)
```

Data Pre-Processing
-------------------
It's important to apply a function in order to filter the features with any missing data, in other words, there are many variables in the dataset and it's imperative to remove any with NA's values or empty strings. It's also being removed all columns that are not included in the prediction model.
It's important to point that it's not necessary to **create a data partition** for these datasets because there are already two set of files one for training and one for testing.

```{r, cache=TRUE, echo=TRUE}
filteringdata<-function(dataset)
  {
  keepdata<-!sapply(dataset, function(x) any(is.na(x)))
  dataset<-dataset[,keepdata]
  keepdata<-!sapply(dataset, function(x) any(x==""))
  dataset<-dataset[,keepdata]
  
  removingcol<-c("X", "user_name", "raw_timestamp_part_1", "raw_timestamp_part_2", "cvtd_timestamp", "new_window", "num_window")
  doremove<-which(colnames(dataset) %in% removingcol)
  dataset<-dataset[,-doremove]
  return(dataset)
  }
data.training<-filteringdata(data.training)
data.training$classe<-factor(data.training$classe)
data.testing<-filteringdata(data.testing)

#head(data.training)
#head(data.testing)

histGroup <- function (data, regex) {
  col <- grep(regex, names(data))
  col <- c(col, which(names(data) == "classe"))
  n <- nrow(data)
  DMelted <- melt(data[, col, ][ , ], id.vars=c("classe"))
  ggplot(DMelted, aes(x=classe, y=value)) +
    geom_violin(aes(color=classe, fill=classe), alpha=1/2) +
    facet_wrap(~ variable, scale="free_y") +
    scale_color_brewer(palette="Spectral") +
    scale_fill_brewer(palette="Spectral") +
    labs(x="", y="") +
    theme(legend.position="none")
}

histGroup(data.training,"belt")

```

Train The Prediction Model
--------------------------

You can also embed plots, for example:

```{r fig.width=7, fig.height=6}
plot(cars)
```


Applying Prediction Mode On Data Test
-------------------------------------



